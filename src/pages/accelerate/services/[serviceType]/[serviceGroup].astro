---
import { sanityClient } from "sanity:client"
import { paths } from "../../../../components/global/utils/paths"
import LayoutStudio from "../../../../layouts/LayoutStudio.astro"

export async function getStaticPaths() {
    const serviceGroups = await sanityClient.fetch(`*[_type == "type_serviceGroup" && "Studio" in agencyBrands[]->name ] {..., serviceType->{...} }`)
    return serviceGroups.map((serviceGroup) => {
        return {
            params: { serviceType: serviceGroup.serviceType.slug.current, serviceGroup: serviceGroup.slug.current },
            props: { content: serviceGroup, serviceType: serviceGroup.serviceType }
        }
    })
}

interface Props {
    content: any,
    serviceType: any,
}

const { content, serviceType } = Astro.props;
const services = await sanityClient.fetch(`*[_type == "type_service" && serviceGroup->_id == '${content._id}' && "Studio" in agencyBrands[]->name] | order(orderRank)`)

---
<LayoutStudio
    title={content.metafields && content.metafields.title ? content.metafields.title : content.title}
>
    <a href={`${paths.root.studio.services.path}/${serviceType.slug.current}`}><h3>{serviceType.title}</h3></a>
    <h1 data-pagefind-filter="type:service-group">{content.title}</h1>
    {services.map((service) => (
        <div>
            <a href={`${paths.root.studio.services.path}/${serviceType.slug.current}/${service.slug.current}`}><p>{service.title}</p></a>
        </div>
    ))}

</LayoutStudio>