---
import { sanityClient } from 'sanity:client';
import LayoutDomaine from '../../layouts/Layout-Domaine.astro';
import { paths } from '../../components/global/utils/paths';
import PartnerTile from '../../components/global/partners/global-PartnerTile.astro'
import { imageFields, partnerTileFields } from '../../components/global/utils/cms-queries';

const partnerTiers =  await sanityClient.fetch(`*[_type == "type_partnerTier"]{ ..., "partners": *[_type == "type_partner" && references(^._id)]{ ${partnerTileFields} } }`)
---
<LayoutDomaine
    title="Partners"
    searchFilter="type:page"
>
    <div class="partner-tiers">
        <h1>Partners</h1>
        {partnerTiers.map((tier) => (
            <section>
                <h3>{tier.title}</h3>
                <div class="partners">
                    {tier.partners.map((partner) => (
                        <PartnerTile 
                            partner={partner}
                        />
                    ))}
                </div>
            </section>
        ))}
    </div>

</LayoutDomaine>

<style>

    .partner-tiers {
        padding-inline: var(--page-margin);
        padding-block: var(--header-height) var(--space-xl);
    }

    .partners {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-xs);
    }
</style>