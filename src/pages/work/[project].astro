---
// SERVER RENDERED AT LOAD TIME
import LayoutProject from '../../layouts/Layout_Project.astro';
import { Brands } from '../../enums/brands';
import { imageFields, videoFields } from '../../lib/cms-queries';
import { imageBaseFields } from '../../lib/cms-queries';
import { globalSectionsFields } from '../../lib/cms-queries';
import { loadQuery } from '../../lib/sanity-load-query';

const { project } = Astro.params
const { data: projectContent } = await loadQuery({
    query: `*[_type == "type_project" && isHidden != true && agencyBrand->name == '${Brands.DOMAINE}' && slug.current == '${project}']{
        ...,
        title,
        isHidden,
        description,
        excerpt,
        industry->{...},
        url,
        client->{..., logoDark{${imageBaseFields}}, logoLight{${imageBaseFields}}, isEnterprise, "logo": logo.asset->url },
        foregroundColor,
        backgroundColor,
        accentColor,
        services[]->{..., serviceGroup->{slug, title, serviceType->{slug} } },
        features[]->{...},
        partners[]->{..., title, excerpt, slug, icon{${imageFields}}, tier->{..., createLandingPages}, websiteUrl },
        metrics[]{...},
        awards[]{...},
        agencyBrand->{slug, name},
        thumbnailMedia{${videoFields}, ${imageFields}},
        thumbnailImageSecondary{${imageFields}},
        slug{...},
        heroMedia{..., ${videoFields}, ${imageFields}},
        sections[]{${globalSectionsFields}},
        metafields{ title, description, image{${imageBaseFields}} },
        orderRank,
    }[0]`
})

if (projectContent === null) return Astro.redirect('/404')
---
<LayoutProject 
    content={projectContent}
    brand={Brands.DOMAINE}
/>