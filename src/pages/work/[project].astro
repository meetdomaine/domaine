---
// SERVER RENDERED AT LOAD TIME
import LayoutProject from '../../layouts/Layout_Project.astro';
import { Brands } from '../../enums/brands';
import { imageFields, videoFields } from '../../lib/cms-queries';
import { imageBaseFields } from '../../lib/cms-queries';
import { globalSectionsFields } from '../../lib/cms-queries';
import { sanityClient } from 'sanity:client';

const { project } = Astro.params
const projectContent = await sanityClient.fetch(`*[_type == "type_project" && isHidden != true && agencyBrand->name == '${Brands.DOMAINE}' && slug.current == '${project}']{
      title,
      isHidden,
      description,
      excerpt,
      industry->{ slug, title },
      url,
      client->{ slug, title, logoDark{${imageBaseFields}}, logoLight{${imageBaseFields}}, isEnterprise, "logo": logo.asset->url },
      foregroundColor,
      backgroundColor,
      accentColor,
      services[]->{ title, slug, serviceGroup->{slug, title, serviceType->{slug} } },
      features[]->{ title, slug },
      partners[]->{ title, excerpt, slug, icon{${imageFields}}, tier->{ createLandingPages}, websiteUrl },
      metrics[]{ label, number },
      awards[]{ awardTitle, publication },
      agencyBrand->{slug, name},
      thumbnailMedia{${videoFields}, ${imageFields}},
      thumbnailImageSecondary{${imageFields}},
      slug,
      heroMedia{${videoFields}, ${imageFields}},
      sections[]{${globalSectionsFields}},
      metafields{ title, description, image{${imageBaseFields}} },
      redirectPath,
      orderRank,
  }[0]`
)
if (projectContent?.redirectPath) return Astro.redirect(projectContent.redirectPath)
if (projectContent === null) return Astro.redirect('/404')
---
<LayoutProject 
    content={projectContent}
    brand={Brands.DOMAINE}
/>