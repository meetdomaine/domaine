---
// SERVER RENDERED AT LOAD TIME
import LayoutProjectsIndex from '../../../layouts/Layout_ProjectsIndex.astro';
import { Brands } from '../../../enums/brands';
import { projectGridFields } from '../../../lib/cms-queries';
import { loadQuery } from '../../../lib/sanity-load-query';

const { partner } = Astro.params
const { data: partnerContent } = await loadQuery({
    query: `*[_type == "type_partner" && defined(*[_type == "type_project" && agencyBrand->name == '${Brands.DOMAINE}' && references(^._id)][0]) && slug.current == '${partner}'][0]{
        _id,
        title, 
        slug, 
        excerpt,
        description,
        tier->{slug, title, createLandingPages},
        "projects": *[_type == "type_project" && agencyBrand->name == '${Brands.DOMAINE}' && isHidden != true  && ^.slug.current in partners[]->slug.current ]{${projectGridFields}} | order(orderRank),
        websiteUrl, 
        websiteText,
        instagramUrl,
        twitterUrl,
        linkedInUrl,
        youTubeUrl,
        tikTokUrl,
        "hasContent": {
            "${Brands.DOMAINE}": defined(*[_type == "type_project" && isHidden != true && agencyBrand->name == '${Brands.DOMAINE}' && references(^._id)][0]),
        },
    }`
})
---
<LayoutProjectsIndex
    content={partnerContent}
    projects={partnerContent.projects}
    currentPath={`/partners/${partnerContent?.slug?.current}`}
    brand={Brands.DOMAINE}
/>