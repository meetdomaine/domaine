---
// SERVER RENDERED
import LayoutService from '../../../../layouts/Layout_Service.astro';
import { Brands } from '../../../../enums/brands';
import { sanityClient } from 'sanity:client';
import { globalSectionsFields } from '../../../../lib/cms-queries';
import { imageBaseFields } from '../../../../lib/cms-queries';

const { service, service_group, service_type } = Astro.params

const serviceContent = await sanityClient.fetch(`*[_type == "type_service" && '${Brands.DOMAINE}' in agencyBrands[]->name && slug.current == '${service}'][0]{
    title,
    slug,
    excerpt,
    description,
    formHeading,
    formText,
    hubspotFormId,
    agencyBrands[]->{ name },
    serviceGroup->{
        title,
        slug,
        formHeading,
        formText,
        hubspotFormId,
        serviceType->{
            title,
            slug,
            formHeading,
            formText,
            hubspotFormId
        }
    },
    pageSectionsDomaine[]{${globalSectionsFields}},
    metafields{ title, description, image{${imageBaseFields}} },
  }`
)
if (!serviceContent || serviceContent.serviceGroup.slug.current !== service_group || serviceContent.serviceGroup.serviceType.slug.current !== service_type) return Astro.redirect('/404')
---
<LayoutService 
    content={serviceContent}
    brand={Brands.DOMAINE}
    activePath="/services"
/>
