---
import { sanityClient } from "sanity:client"
import LayoutDomaine from "../../../layouts/Layout-Domaine.astro"
import SectionServiceTypeHero from "../../../components/global/services/serviceType-Hero.astro"
import { serviceTypePageQuery } from "../../../components/global/utils/cms-queries"
import SectionProjectsFeed from "../../../components/global/sections/section-ProjectsFeed.astro"
import SectionBlogFeed from "../../../components/global/sections/section-BlogFeed.astro"
import GlobalSections from "../../../components/global/sections/section-GlobalSections.astro"

export const prerender = true

export async function getStaticPaths() {
    const serviceTypes = await sanityClient.fetch(`*[_type == "type_serviceType" && 'Domaine' in agencyBrands[]->name ]{..., ${serviceTypePageQuery}} | order(orderRank)`)
    return serviceTypes.map((serviceType) => {
        return {
            params: { serviceType: serviceType.slug.current },
            props: { content: serviceType }
        }
    })
}

interface Props {
    content: any,
}

const { content } = Astro.props;
// console.log(content)
---
<LayoutDomaine
    title={content.metafields && content.metafields.title ? content.metafields.title : content.title}
    searchFilter="type:service-type"
    activePath="/services"
>
    <SectionServiceTypeHero
        serviceType={content}
    />
    
    {content.pageSectionsDomaine && content.pageSectionsDomaine.map((section, i) => (
        <GlobalSections brand="domaine" section={section} key={i} />
    ))}

    {content.relatedBlogPosts && content.relatedBlogPosts?.length > 0 &&
        <SectionBlogFeed 
            heading={`${content.title} Insights`}
            posts={content.relatedBlogPosts}
            sidebarTitle={content.title}
        />
    }

    <!-- {content.formHeading && content.hubspotFormId &&
        <SectionForm 
            heading={content.formHeading}
            text={content.formText}
            hubspotFormId={content.hubspotFormId}
        />
    } -->

    {content.relatedProjects?.length > 0 &&
        <SectionProjectsFeed 
            heading={`${content.title} Work`}
            projects={content.relatedProjects}
        />
    }

</LayoutDomaine>