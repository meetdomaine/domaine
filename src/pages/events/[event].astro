---
import LayoutEvent from "../../layouts/Layout_Event.astro";
import { loadQuery } from "../../lib/sanity-load-query";
import { imageFields, globalSectionsFields } from "../../lib/cms-queries";
import { Locales } from "../../enums/locales";

const { event } = Astro.params
const { data: eventContent } = await loadQuery({ 
  query: `*[_type == "type_event" && slug.current == '${event}'][0]{
    _id,
    title,
    eyebrow,
    description,
    slug,
    dateTime,
    timezone,
    use24hourFormat,
    venue,
    venueUrl,
    location,
    button{ label, url, newTab },
    partnersHeading,
    partnersSubheading,
    speakersHeading,
    speakersSubheading,
    partnerLogos[]{${imageFields}},
    speakers[]{ speakerName, speakerRole, speakerImage{${imageFields}}, speakerLogo{${imageFields}} },
    thumbnailImage{${imageFields}},
    globalSections{ sections[]{${globalSectionsFields}}},
    metafields{ title, description, image },
    redirectPath,
  }`
})
console.log(eventContent.timezone)

if (eventContent?.redirectPath) return Astro.redirect(eventContent.redirectPath)
if (!eventContent) return Astro.redirect('/404')
---
<LayoutEvent 
  content={eventContent}
  locale={Locales.EN}
/>