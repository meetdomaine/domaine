---
import LayoutService from "../../../../../layouts/Layout_Service.astro"
import { Brands } from "../../../../../enums/brands"
import { sanityClient } from "sanity:client";
import { globalSectionsFields } from "../../../../../lib/cms-queries";
import { imageBaseFields } from "../../../../../lib/cms-queries";
import { Locales } from "../../../../../enums/locales";

const { service, service_group, service_type } = Astro.params

const serviceContent = await sanityClient.fetch(`*[_type == "type_service" && '${Brands.STUDIO}' in agencyBrands[]->name && slug.current == '${service}'][0]{
    title,
    slug,
    excerpt,
    description,
    formHeading,
    formText,
    hubspotFormId,
    agencyBrands[]->{ name },
    serviceGroup->{
        title,
        slug,
        formHeading,
        formText,
        hubspotFormId,
        serviceType->{
            title,
            slug,
            formHeading,
            formText,
            hubspotFormId
        }
    },
    pageSectionsStudio[]{${globalSectionsFields}},
    metafields{ title, description, image{${imageBaseFields}} },
  }`
)
if (!serviceContent || serviceContent.serviceGroup.slug.current !== service_group || serviceContent.serviceGroup.serviceType.slug.current !== service_type) return Astro.redirect('/404')
---
<LayoutService
    content={serviceContent}
    brand={Brands.STUDIO}
    activePath="/studio/services"
    locale={Locales.EN}
/>