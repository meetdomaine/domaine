---
// SERVER RENDERED
import LayoutServiceType from "../../../../layouts/Layout_ServiceType.astro"
import { Brands } from "../../../../enums/brands"
import { sanityClient } from "sanity:client";
import { globalSectionsFields } from "../../../../lib/cms-queries";
import { imageBaseFields } from "../../../../lib/cms-queries";
import { imageFields } from "../../../../lib/cms-queries";
import { Locales } from "../../../../enums/locales";

const { service_type } = Astro.params
const serviceTypeContent = await sanityClient.fetch(`*[_type == "type_serviceType" && slug.current == '${service_type}'][0]{
    _id,
    title,
    description,
    slug,
    agencyBrands[]->{ _id, name, slug },
    pageSectionsStudio[]{${globalSectionsFields}},
    globalSectionsStudio{ sections[]{${globalSectionsFields}} },
    "serviceGroups": *[_type == "type_serviceGroup" && references(^._id) ]{
        _id,
        title,
        description,
        slug,
        orderRank,
        serviceType->{slug},
        "services": *[_type == "type_service" && references(^._id)] {
            _id,
            title,
            description,
            slug,
            orderRank
        } | order(orderRank)
    } | order(orderRank),
    isHidden,
    excerpt,
    images[]{${imageFields}},
    metafields{ title, description, image{${imageBaseFields}} },
    orderRank
}`
)
if (!serviceTypeContent) return Astro.redirect('/404')
---
<LayoutServiceType 
    content={serviceTypeContent}
    activePath="/studio/services"
    brand={Brands.STUDIO}
    locale={Locales.EN}
/>