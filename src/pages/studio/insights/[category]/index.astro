---
import { Brands } from '../../../../enums/brands';
import LayoutBlogIndex from '../../../../layouts/Layout_BlogIndex.astro';
import { urlFor } from '../../../../lib/cms-queries';
import { getCollection } from 'astro:content';
import { getEntry } from 'astro:content';

export async function getStaticPaths() {
    const categories = await getCollection('blogCategories_Studio')
    return categories.map((category) => {
        return {
            params: { 
                category: category.id
            },
            props: { content: {...category.data} }
        }
    })
}

const { content } = Astro.props
const pageSettings = await getEntry('pageSettings', 'page_blog-index-studio')
const blogPosts = await Promise.all(content.posts.map(async (blogPost) => await getEntry('blogPosts_Studio', blogPost.slug.current)))
---
<LayoutBlogIndex
    title={pageSettings.data.metafields?.title ? pageSettings.data.metafields.title : pageSettings.data.title}
    description={pageSettings.data.metafields?.description ? pageSettings.data.metafields.description : null}
    image={pageSettings.data.metafields?.image ? urlFor(pageSettings.data.metafields.image).url() : null}
    pageSettings={pageSettings.data}
    blogPosts={blogPosts}
    heading={pageSettings.data.title}
    subheading={pageSettings.data.heading}
    searchFilter="type:page"
    showPreloader={false}
    brand={Brands.STUDIO}
    slug={content.slug}
/>
