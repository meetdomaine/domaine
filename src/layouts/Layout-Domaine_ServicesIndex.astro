---
import LayoutDomaine from "../layouts/Layout-Domaine.astro";
import ServicesHero from "../components/domaine/sections/services/services-Hero.astro";
import GlobalSections from "../components/global/sections/section-GlobalSections.astro";
import { urlFor, imageFields, globalSectionsFields, imageBaseFields } from "../lib/cms-queries";
import { getTranslationString } from "../lib/translations";
import { sanityClient } from "sanity:client";
import { Brands } from "../enums/brands";

const pageSettings = await sanityClient.fetch(`*[_type == "page_services-index-domaine"][0]{
    _id,
    title,
    heading,
    images[]{${imageFields}},
    sections[]{${globalSectionsFields}},
    metafields{ title, description, image{${imageBaseFields}} },
  }`
)
const { brand, locale } = Astro.props
const description = pageSettings?.metafields?.description?.text || pageSettings?.metafields?.description
---
<LayoutDomaine
    title={`${pageSettings.metafields?.title ? getTranslationString(pageSettings.metafields.title, locale) : pageSettings.title.text}`}
    description={description ? getTranslationString(description, locale) : null}
    image={pageSettings.metafields?.image ? urlFor(pageSettings.metafields.image).url() : null}
    activePath="/services"
    showPreloader={false}
    locale={locale}
>   
    <ServicesHero
        title={pageSettings.title}
        heading={pageSettings.heading}
        brand={brand}
        locale={locale}
    />

    {pageSettings.sections && pageSettings.sections.map((section, i) => (
        <GlobalSections brand={Brands.DOMAINE} section={section} key={i} locale={locale} />
    ))}

</LayoutDomaine>