---
import { Icon } from "astro-icon/components"
import AtomSanityImage from "../atoms/atom-sanityImage.astro"

const { section, brand, key } = Astro.props
// console.log(section.serviceType.images)
console.log(section)

---
<section class="section-service-type" id={`service-type-${section.featuredService.slug.current}`}>
    <h2><a href={`${brand === "studio" ? "/studio" : ""}/services/${section.featuredService._type === "type_serviceGroup" ? `${section.featuredService.serviceType.slug.current}/` : '' }${section.featuredService.slug.current}/`} class="service-type-title title-xl">{section.featuredService.title}</a></h2>
    <div class="section-content">

        <p class="service-type-heading h4">{section.featuredService.excerpt}</p>
        <div class="service-groups">
            {section.featuredService._type === "type_serviceType" ? 
                section.featuredService.serviceGroups.map((serviceGroup) => (
                    <div class="services">
                        <a class="service-group-title h6" href={`${brand === "studio" ? "/studio" : ""}/services/${section.featuredService.slug.current}/${serviceGroup.slug.current}`}>{serviceGroup.title}</a>
                        {serviceGroup.services.map((service) => (
                            <a class="service" href={`${brand === "studio" ? "/studio" : ""}/services/${section.featuredService.slug.current}/${service.slug.current}`}>
                                <p class="service-title">{service.title}</p>
                                <Icon name="arrow-forward" />
                                { service.excerpt && 
                                    <div class="service-detail" data-color-scheme="glass-light">
                                        <p>{service.excerpt}</p> 
                                    </div>
                                }
                            </a>
                        ))}
                    </div>
                )) : 
                section.featuredService.services.map((service) => (
                    <a class="service" href={`${brand === "studio" ? "/studio" : ""}/services/${service.serviceGroup.serviceType.slug.current}/${service.slug.current}`}>
                        {/* <a class="service-group-title" href={`${brand === "studio" ? "/studio" : ""}/services/${section.featuredService.slug.current}/${serviceGroup.slug.current}`}>{serviceGroup.title}</a> */}
                        <p class="service-title">{service.title}</p>
                        <Icon name="arrow-forward" />
                        { service.excerpt && 
                            <div class="service-detail" data-color-scheme="glass-light">
                                <p>{service.excerpt}</p> 
                            </div>
                        }
                    </a>
                ))
            }
        </div>
    </div>
    <div class="section-media">
        {section.featuredService.images && section.featuredService.images.slice(0,2).map((asset) => (
            <div class="service-image" data-animate-viewport="true" data-animation="fade">
                <AtomSanityImage 
                    image={asset.image}
                    sizes="30vw"
                    cover={true}
                />
            </div>
        ))}
    </div>
</section>

<script>
import { addParallax, gsap } from "../utils/gsap"
import { isMobileBreakpoint } from "../../global/utils/check-device"

if (!isMobileBreakpoint) {
    const sections = document.querySelectorAll('.section-service-type')

    const _parallaxStrength = 30

    sections.forEach((section) => {

        const images = section.querySelectorAll('.service-image')

        images.forEach((image) => {

            const timeline = gsap.timeline({
                scrollTrigger: {
                    trigger: image,
                    start: 'top bottom',
                    end: 'bottom top',
                    scrub: true,
                }
             })
            
            timeline.fromTo(image, { y: _parallaxStrength }, { y: -_parallaxStrength });
        })
        
    })
}
</script>

<style>
    .section-service-type {
        position: relative;
        padding-inline: var(--page-margin);
        padding-block: var(--space-4xl) var(--space-4xl);
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-lg);
    }

    .service-type-title {
        position: relative;
        text-decoration: none;
        z-index: 2;
    }

    .section-content {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: var(--space-lg);
        width: 85%;
        align-self: flex-end;
        z-index: 1;
    }

    .service-type-heading {
        max-width: 24em;
    }

    .service-groups {
        display: flex;
        flex-direction: column;
        max-width: 35rem;
        padding: var(--space-xs);
        border-radius: var(--radius-sm);
    }

    .services {
        display: flex;
        flex-direction: column;
    }

    .service {
        position: relative;
    }

    .service:hover {
        transition: color var(--anim-sm), padding var(--anim-sm);
        color: var(--color-background);
        padding-inline: var(--space-xs);
    }

    .service::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: 0;
        right: 0;
        height: 0%;
        transition: height var(--anim-sm);
        background-color: var(--color-foreground);
        z-index: -1;
        border-radius: var(--radius-sm);
    }


    .service-detail {
        position: absolute;
        max-width: 16em;
        top: calc(var(--space-2xs) * -1);
        right: calc(var(--space-xs) * -1);
        translate: 100% 20px;
        color: var(--color-foreground);
        /* color: var(--color-background); */
        /* mix-blend-mode: difference; */
        opacity: 0;
        pointer-events: none;
        transition: opacity var(--anim-sm), translate var(--anim-sm);
        padding: var(--space-2xs);
        border-radius: var(--radius-sm);
        /* background-color: var(--color-background); */
    }

    .service:hover::after {
        height: 100%;
    }

    .service:hover .service-detail {
        opacity: 1;
        translate: 100% 0px;
    }

    .service,
    .service-group-title {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        border-bottom: 1px solid var(--color-border);
        padding-block: 0.5em;
        text-decoration: none;
    }


    .service-group-title,
    .service-title {
        margin: 0;
        text-decoration: none;
    }

    .service-group-title {
        border-color: var(--color-foreground);
        margin-top: var(--space-md);
    }

    .service-group-title:hover {
        color: var(--color-foreground);
    }

    .service-title {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
    }

    .section-media {
        position: absolute;
        inset: 0;
        display: grid;
        grid-template-columns: 2fr 2fr 2fr 1fr 1fr 1fr;
        grid-template-rows: repeat(4, 1fr);
        z-index: 0;
        aspect-ratio: 4 / 3;
    }

    .service-image {
        position: relative;
        height: 100%;
        min-height: 0;
    }

    .section-service-type:nth-of-type(4n + 1) {

    }
        
    /* Every First instance */
    .service-image:nth-child(1) {
        grid-column: 6 / span 1;
        grid-row: 1 / span 1;
    }

    .service-image:nth-child(2) {
        grid-column: 4 / span 2;
        grid-row: 2 / span 1;
    }

    /* Every Fourth instance */
    .section-service-type:nth-of-type(4n + 1) .service-image:nth-child(1) {
        grid-column: 4 / span 1;
        grid-row: 1 / span 1;
    }

    .section-service-type:nth-of-type(4n + 1) .service-image:nth-child(2) {
        grid-column: 5 / span 1;
        grid-row: 2 / span 1;
    }

    /* Every Second instance */
    .section-service-type:nth-of-type(4n + 3) .service-image:nth-child(1) {
        grid-column: 5 / span 1;
        grid-row: 1 / span 1;
    }

    .section-service-type:nth-of-type(4n + 3) .service-image:nth-child(2) {
        grid-column: 6 / span 1;
        grid-row: 2 / span 1;
    }

    /* Every Third instance */
    .section-service-type:nth-of-type(4n + 4) .service-image:nth-child(1) {
        grid-column: 5 / span 1;
        grid-row: 2 / span 1;
    }

    .section-service-type:nth-of-type(4n + 4) .service-image:nth-child(2) {
        grid-column: 6 / span 1;
        grid-row: 4 / span 1;
    }

    
    @media screen and (width <= 768px) {
        .section-content {
            width: 100%;
        }

        .service-groups {
            padding: 0;
        }

        .service-detail {
            display: none;
        }

        .section-media {
            position: relative;
            grid-template-columns: var(--grid-template-extreme-1);
            grid-template-rows: repeat(3, 1fr);
            height: 50svh;
        }

        .service-image:nth-child(3n + 1) {
            grid-column: 2 / span 1;
            grid-row: 1 / span 1;
        }

        .service-image:nth-child(3n + 2) {
            grid-column: 3 / span 1;
            grid-row: 2 / span 1;
        }

        .service-image:nth-child(3n + 3) {
            grid-column: 1 / span 1;
            grid-row: 3 / span 1;
        }

        .section-service-type:nth-child(even) .service-image:nth-child(3n + 1) {
            grid-column: 3 / span 1;
            grid-row: 1 / span 1;
        }

        .section-service-type:nth-child(even) .service-image:nth-child(3n + 2) {
            grid-column: 1 / span 1;
            grid-row: 2 / span 1;
            /* opacity: 0; */
        }

        .section-service-type:nth-child(even) .service-image:nth-child(3n + 3) {
            grid-column: 2 / span 1;
            grid-row: 3 / span 1;
            /* opacity: 0; */
        }
    }
</style>