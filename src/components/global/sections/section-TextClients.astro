---
import { sanityClient } from "sanity:client"
import { imageBaseFields, imageFields, urlFor } from "../utils/cms-queries"
import AtomSanityImage from "../atoms/atom-sanityImage.astro"
const { section, brand, key } = Astro.props

const clientLogos = await sanityClient.fetch(`
    *[_type == "type_client" 
        && count(*[_type == "type_project" 
            && agencyBrand->slug.current == '${brand}'
                && references(^._id) ]) > 0 ]{ 
                    title, 
                    orderRank, 
                    logoDark{${imageBaseFields}} 
                } | order(orderRank)[0...6]`)
// console.log(clientLogos)
---
<section class="section-text-clients">
    <div 
        class="section-text"
        data-animate-viewport="true"
        data-animation="fade-up"
    >
        {section.eyebrow && <p class="utility">{section.eyebrow}</p>}
        <h2 class="h1">{section.heading}</h2>
    </div>
    <div class="logos">
        {clientLogos.map((client, i) => (
            <div 
                class="logo"
                data-animate-viewport="true"
                data-animation="fade"
                data-animation-delay={150 * i}
            >
                <AtomSanityImage 
                    image={client.logoDark} 
                    contain={true}
                    sizes="30vw"
                />
            </div>
        ))}
    </div>
</section>

<style>
    .section-text-clients {
        padding-inline: var(--page-margin);
        padding-block: var(--space-xl);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        min-height: 60svh;
    }

    .section-text {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--space-sm);
        max-width: 60rem;
    }

    .logos {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        justify-items: center;
        align-items: center;
        width: 80%;
    }

    .logo {
        width: 70%;
        height: 20%;
        aspect-ratio: 1 / 1;
    }

    @media screen and (width < 768px) {
        .logos {
            grid-template-columns: repeat(3, 1fr);
        }
    }
</style>