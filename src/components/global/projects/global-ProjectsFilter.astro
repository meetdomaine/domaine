---
import { Icon } from 'astro-icon/components';
import AtomTag from '../atoms/atom-tag.astro';
import {
    getProjectFeatures_Domaine,
    getProjectFeatures_Studio,
    getPartners_Studio,
    getPartners_Domaine,
    getServiceGroups_Studio,
    getServiceGroups_Domaine,
    getClientsIndustries_Studio,
    getClientsIndustries_Domaine,
} from '../utils/cms-content';

const { brand, currentPath } = Astro.props;

const allFilters = await Promise.all([
    {
        title: 'Industries',
        path: 'industries/',
        filters: brand.toLowerCase() === "studio" ? await getClientsIndustries_Studio() : await getClientsIndustries_Domaine()
    },
    {
        title: 'Features',
        path: 'features/',
        filters: brand.toLowerCase() === "studio" ? await getProjectFeatures_Studio() : await getProjectFeatures_Domaine()
    },
    {
        title: 'Partners',
        path: 'partners/',
        filters: brand.toLowerCase() === "studio" ? await getPartners_Studio() : await getPartners_Domaine()
    },
    {
        title: 'Services',
        path: 'services/',
        filters: brand.toLowerCase() === "studio" ? await getServiceGroups_Studio() : await getServiceGroups_Domaine()
    },
])

// console.log(brand)

---
<dialog popover id="projects-filter" class="projects-filter" >
    <div class="section-title">
        <h2 class="h5">Filter Projects</h2>
        <button class="close-button button-reset" popovertarget="projects-filter">
            <Icon class="close-icon" name="pixel_x" />
        </button>
    </div>
    <div class="section-content">
        {allFilters.map((filterGroup) => (
            <div class="filter-type">
                <p class="filter-title h6">{filterGroup.title}</p>
                <div class="filters">
                    {filterGroup.filters.map((filter) => {
                        return (
                            <AtomTag 
                                text={filter.title}
                                url={`/${brand === "Studio" ? "studio/" : ""}work/${filterGroup.path}${filter.slug.current}`}
                                theme={currentPath == `/${filterGroup.path}${filter.slug.current}` ? "dark" : "light"}
                            />
                        )
                    })}
                </div>
            </div>
        ))}
    </div>
</dialog>

<style>

    

    .projects-filter {
        opacity: 0;
        translate: 0 5rem;
        /* display: none; */
        /* display: flex; */
        flex-direction: column;
        gap: var(--space-3xl);
        padding-inline: var(--page-margin);
        padding-block: var(--space-md);
        border: none;
        outline: none;
        /* overflow: hidden; */
        width: min(60em, calc(100% - var(--page-margin) * 2));
        border-radius: var(--radius-sm);
        margin-right: var(--page-margin);
        margin-top: var(--space-sm);
        justify-self: flex-end;
        transition: none;
        transition: 
            overlay var(--anim-sm) allow-discrete,
            display var(--anim-sm) allow-discrete; 
    }

    .projects-filter:popover-open {
        translate: 0 0;
        opacity: 1;
        display: flex;
        transition: 
            translate var(--anim-sm), 
            opacity var(--anim-sm), 
            overlay var(--anim-sm) allow-discrete,
            display var(--anim-sm) allow-discrete; 
    }

    .projects-filter::backdrop {
        opacity: 0;
        background-color: var(--background-blur-color);
        backdrop-filter: var(--background-blur);
        -webkit-backdrop-filter: var(--background-blur);
        pointer-events: all;
        transition: 
            opacity var(--anim-sm), 
            overlay var(--anim-sm) allow-discrete,
            display var(--anim-sm) allow-discrete; 
    }

    .projects-filter:popover-open::backdrop {
        opacity: 1;
    }

    @starting-style {
        .projects-filter:popover-open {
            opacity: 0;
            display: flex;
            gap: var(--space-3xl);
            translate: 0 5rem;
        }

        .projects-filter:popover-open::backdrop {
            opacity: 0;
        }
    }


    .section-title {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
    }

    .close-icon  {
        width: var(--icon-md);
        height: var(--icon-md);
    }

    .section-content {
        display: flex;
        flex-direction: column;
        gap: var(--space-xl);
    }

    .filter-type {
        border-bottom: 1px solid var(--color-border);
        display: flex;
        flex-direction: row;
        gap: var(--space-lg);
        flex-wrap: wrap;
    }

    .filter-type:last-child {
        border-bottom: 1px solid transparent;
    }

    .filter-title {
        flex: 0 0 20%;
    }

    .filters {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        margin-bottom: var(--space-xl);
        gap: var(--space-2xs);
        flex: 1 0 min(30rem, 100%);
    }

</style>