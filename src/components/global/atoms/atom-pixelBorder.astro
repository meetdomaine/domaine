---
const id = Math.random().toString(16).slice(2)

const canvasHeight = 30
---
<canvas id={`pixel-border-${id}`} class="pixel-canvas" width="100" height={canvasHeight}></canvas>

<script define:vars={{ id, canvasHeight }}>

    const canvas = document.getElementById(`pixel-border-${id}`)

    const _density = 5 // Should be divisible by canvasHeight

    const drawPixels = () => {

        const ctx = canvas.getContext("2d");
        let image
        let width
        let height

        const draw = (t) => {
            const arr = new Uint32Array(image.data.buffer);

            const size = canvasHeight / _density;

            for (let y = 0; y < height; y += size) {
                const probability = y / height
                for (let x = 0; x < width; x += size) {
                    const color = Math.random() < probability ? 0xFFFFFFFF : 0x00000000;
                    for (let dy = 0; dy < size; dy++) {
                        for (let dx = 0; dx < size; dx++) {
                            const index = (y + dy) * width + (x + dx);
                            arr[index] = color;
                        }
                    }
                }
            }
            ctx.putImageData(image, 0, 0);
            // requestAnimationFrame(draw)
            // setTimeout(() => {
            //     draw()
            // }, 500)
        };

        onresize = (evt) => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = canvasHeight;
            image = new ImageData(width, height);
            draw();
        };

        window.addEventListener("keypress", (e) => {
            if (e.code === "KeyE") draw();
            // console.log(e)
        })

        onresize();
        draw();
    }

    drawPixels()

    

</script>

<style>
    .pixel-canvas {
        /* position: relative; */
        translate: 0 -100%;
        /* height: 0; */
        /* margin-top: -100%; */
        /* z-index: 2; */
    }
</style>